<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>DKBat Invoice</title>

<style>
body { font-family: Arial; background:#f2f2f2; }
#invoice {
  width:210mm;
  min-height:297mm;
  background:#fff;
  margin:auto;
  padding:20mm;
}
button {
  padding:10px 16px;
  margin:10px;
}
@media print {
  button { display:none; }
}
</style>
</head>

<body>

<div id="invoice">
  <center>
    <img src="https://i.imgur.com/1Q9Z1Zm.png" width="120"><br>
    <h2>DKBat Massage Invoice</h2>
  </center>

  <p><b>Name:</b> <span id="name">-</span></p>
  <p><b>Service:</b> <span id="service">-</span></p>
  <p><b>Status:</b> <span id="status">-</span></p>
  <p><b>Date:</b> <span id="date">-</span></p>
  <p><b>Time:</b> <span id="time">-</span></p>
</div>

<center>
  <button onclick="printInvoice()">ðŸ–¨ Print / Save PDF</button>
  <button onclick="shareWhatsApp()">ðŸ“² Share on WhatsApp</button>
</center>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* ðŸ”¥ FIREBASE CONFIG */
const firebaseConfig = {
  databaseURL: "https://dkbat-orders-default-rtdb.asia-southeast1.firebasedatabase.app"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ðŸ”‘ GET ORDER ID */
const params = new URLSearchParams(window.location.search);
const orderId = params.get("id");

if (!orderId) {
  alert("Invoice ID missing");
}

/* ðŸ”¥ LOAD ORDER DATA */
let orderData = null;

get(ref(db, "orders/" + orderId)).then(snapshot => {
  orderData = snapshot.val();
  if (!orderData) {
    alert("Invoice not found");
    return;
  }

  document.getElementById("name").innerText = orderData.name || "-";
  document.getElementById("service").innerText = orderData.service || "-";
  document.getElementById("status").innerText = orderData.status || "Pending";
  document.getElementById("date").innerText = orderData.date || "-";
  document.getElementById("time").innerText = orderData.time || "-";
});

/* ðŸ–¨ PRINT */
window.printInvoice = function () {
  window.print();
};

/* ðŸ“² WHATSAPP SHARE */
window.shareWhatsApp = function () {
  if (!orderData) return;

  const msg =
`ðŸ§¾ *DKBat Massage Invoice*

ðŸ‘¤ Name: ${orderData.name || "-"}
ðŸ’† Service: ${orderData.service || "-"}
ðŸ“Œ Status: ${orderData.status || "-"}

ðŸ”— Invoice:
${window.location.href}`;

  window.open(
    "https://wa.me/?text=" + encodeURIComponent(msg),
    "_blank"
  );
};
</script>

</body>
</html>
